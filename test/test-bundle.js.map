{"version":3,"file":"test-bundle.js","sources":["src/shims/support.mjs","src/shims/EventTarget.mjs","src/shims/Event.mjs","src/StateChangeEvent.mjs","src/Lifecycle.mjs","src/export.mjs","test/export-test.mjs","test/Lifecycle-test.mjs"],"sourcesContent":["/*\n Copyright 2018 Google Inc. All Rights Reserved.\n Licensed under the Apache License, Version 2.0 (the \"License\");\n you may not use this file except in compliance with the License.\n You may obtain a copy of the License at\n\n     http://www.apache.org/licenses/LICENSE-2.0\n\n Unless required by applicable law or agreed to in writing, software\n distributed under the License is distributed on an \"AS IS\" BASIS,\n WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n See the License for the specific language governing permissions and\n limitations under the License.\n*/\n\nlet supportsConstructableEventTarget;\ntry {\n  new EventTarget();\n  supportsConstructableEventTarget = true;\n} catch (err) {\n  supportsConstructableEventTarget = false;\n}\n\nexport {supportsConstructableEventTarget};\n","/*\n Copyright 2018 Google Inc. All Rights Reserved.\n Licensed under the Apache License, Version 2.0 (the \"License\");\n you may not use this file except in compliance with the License.\n You may obtain a copy of the License at\n\n     http://www.apache.org/licenses/LICENSE-2.0\n\n Unless required by applicable law or agreed to in writing, software\n distributed under the License is distributed on an \"AS IS\" BASIS,\n WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n See the License for the specific language governing permissions and\n limitations under the License.\n*/\n\nimport {supportsConstructableEventTarget} from './support.mjs';\n\n\n/**\n * A minimal EventTarget class shim.\n * This is used if the browser doesn't natively support constructable\n * EventTarget objects.\n */\nclass EventTargetShim {\n  /**\n   * Creates the event registry.\n   */\n  constructor() {\n    this._registry = {};\n  }\n\n  /**\n   * @param {string} type\n   * @param {EventListener|function(!Event):(boolean|undefined)} listener\n   * @param {(boolean|!AddEventListenerOptions)=} opts\n   * @return {undefined}\n   * @see https://dom.spec.whatwg.org/#dom-eventtarget-addeventlistener\n   */\n  addEventListener(type, listener, opts = false) {\n    this._getRegistry(type).push(listener);\n  }\n\n  /**\n   * @param {string} type\n   * @param {EventListener|function(!Event):(boolean|undefined)} listener\n   * @param {(boolean|!EventListenerOptions)=} opts\n   * @return {undefined}\n   * @see https://dom.spec.whatwg.org/#dom-eventtarget-removeeventlistener\n   */\n  removeEventListener(type, listener, opts = false) {\n    const typeRegistry = this._getRegistry(type);\n    const handlerIndex = typeRegistry.indexOf(listener);\n    if (handlerIndex > -1) {\n      typeRegistry.splice(handlerIndex, 1);\n    }\n  }\n\n  /**\n   * @param {!Event|!EventShim} evt\n   * @return {boolean}\n   * @see https://dom.spec.whatwg.org/#dom-eventtarget-dispatchevent\n   */\n  dispatchEvent(evt) {\n    // Set the target then freeze the event object to prevent modification.\n    evt.target = this;\n    Object.freeze(evt);\n\n    this._getRegistry(evt.type).forEach((listener) => listener(evt));\n    return true;\n  }\n\n  /**\n   * Returns an array of handlers associated with the passed event type.\n   * If no handlers have been registered, an empty array is returned.\n   * @private\n   * @param {string} type The event type.\n   * @return {!Array} An array of handler functions.\n   */\n  _getRegistry(type) {\n    return this._registry[type] = (this._registry[type] || []);\n  }\n}\n\nexport default supportsConstructableEventTarget ? EventTarget : EventTargetShim;\n","/*\n Copyright 2018 Google Inc. All Rights Reserved.\n Licensed under the Apache License, Version 2.0 (the \"License\");\n you may not use this file except in compliance with the License.\n You may obtain a copy of the License at\n\n     http://www.apache.org/licenses/LICENSE-2.0\n\n Unless required by applicable law or agreed to in writing, software\n distributed under the License is distributed on an \"AS IS\" BASIS,\n WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n See the License for the specific language governing permissions and\n limitations under the License.\n*/\n\nimport {supportsConstructableEventTarget} from './support.mjs';\n\n/**\n * A minimal Event class shim.\n * This is used if the browser doesn't natively support constructable\n * EventTarget objects.\n */\nclass EventShim {\n  /**\n   * @param {string} type\n   */\n  constructor(type) {\n    this.type = type;\n  }\n}\n\nexport default supportsConstructableEventTarget ? Event : EventShim;\n","/*\n Copyright 2018 Google Inc. All Rights Reserved.\n Licensed under the Apache License, Version 2.0 (the \"License\");\n you may not use this file except in compliance with the License.\n You may obtain a copy of the License at\n\n     http://www.apache.org/licenses/LICENSE-2.0\n\n Unless required by applicable law or agreed to in writing, software\n distributed under the License is distributed on an \"AS IS\" BASIS,\n WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n See the License for the specific language governing permissions and\n limitations under the License.\n*/\n\nimport Event from './shims/Event.mjs';\n\n/**\n * implements {IStateChangeEvent}\n */\nexport default class StateChangeEvent extends Event {\n  /**\n   * @param {string} type\n   * @param {!Object} initDict\n   */\n  constructor(type, initDict) {\n    super(type);\n    this.newState = initDict.newState;\n    this.oldState = initDict.oldState;\n  }\n}\n","/*\n Copyright 2018 Google Inc. All Rights Reserved.\n Licensed under the Apache License, Version 2.0 (the \"License\");\n you may not use this file except in compliance with the License.\n You may obtain a copy of the License at\n\n     http://www.apache.org/licenses/LICENSE-2.0\n\n Unless required by applicable law or agreed to in writing, software\n distributed under the License is distributed on an \"AS IS\" BASIS,\n WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n See the License for the specific language governing permissions and\n limitations under the License.\n*/\n\nimport EventTarget from './shims/EventTarget.mjs';\nimport StateChangeEvent from './StateChangeEvent.mjs';\n\nconst LOADING = 'loading';\nconst ACTIVE = 'active';\nconst PASSIVE = 'passive';\nconst HIDDEN = 'hidden';\nconst FROZEN = 'frozen';\nconst DISCARDED = 'discarded';\nconst TERMINATED = 'terminated';\n\nconst EVENTS = [\n  'pageshow',\n  'resume',\n  'focus',\n  'blur',\n  'pagehide',\n  'visibilitychange',\n  'freeze',\n];\n\n/**\n * Converts an array of states into an object where the state is the key\n * and the value is the index.\n * @param {!Array<string>} arr\n * @return {!Object}\n */\nconst toIndexedObject = (arr) => arr.reduce((acc, val, idx) => {\n  acc[val] = idx;\n  return acc;\n}, {});\n\n/**\n * @param {!Event} evt\n * @return {string}\n */\nconst onbeforeunload = (evt) => {\n  evt.preventDefault();\n  return evt.returnValue = 'Are you sure?';\n};\n\n/**\n * @type {!Array<!Object>}\n */\nconst LEGAL_STATE_TRANSITIONS = [\n  // The normal unload process (bfcache process is addressed above).\n  [ACTIVE, PASSIVE, HIDDEN, TERMINATED],\n\n  // An active page transitioning to frozen,\n  // or an unloading page going into the bfcache.\n  [ACTIVE, PASSIVE, HIDDEN, FROZEN],\n\n  // A loading page can go to either active, passive, or hidden\n  [LOADING, ACTIVE],\n  [LOADING, PASSIVE],\n  [LOADING, HIDDEN],\n\n  // A hidden page transitioning back to active.\n  [HIDDEN, PASSIVE, ACTIVE],\n\n  // A frozen page being resumed\n  [FROZEN, HIDDEN],\n\n  // A frozen (bfcached) page navigated back to\n  // Note: [FROZEN, HIDDEN] can happen here, but it's already covered above.\n  [FROZEN, ACTIVE],\n  [FROZEN, PASSIVE],\n].map(toIndexedObject);\n\n/**\n * Accepts a current state and a future state and returns an array of legal\n * state transition paths. This is needed to normalize behavior across browsers\n * since some browsers do not fire events in certain cases and thus skip\n * states.\n * @param {string} oldState\n * @param {string} newState\n * @return {!Array<string>}\n */\nconst getLegalStateTransitionPath = (oldState, newState) => {\n  // We're intentionally not using for...of here so when we transpile to ES5\n  // to don't need to include the Symbol polyfills.\n  for (let order, i = 0; order = LEGAL_STATE_TRANSITIONS[i]; ++i) {\n    const oldIndex = order[oldState];\n    const newIndex = order[newState];\n\n    if (oldIndex >= 0 &&\n        newIndex >= 0 &&\n        newIndex > oldIndex) {\n      // Differences greater than one should be reported\n      // because it means a state was skipped.\n      return Object.keys(order).slice(oldIndex, newIndex + 1);\n    }\n  }\n  return [];\n  // TODO(philipwalton): it shouldn't be possible to get here, but\n  // consider some kind of warning or call to action if it happens.\n  // console.warn(`Invalid state change detected: ${oldState} > ${newState}`);\n};\n\n\n/**\n * Returns the current state based on the document's visibility and\n * in input focus states. Note this method is only used to determine\n * active vs passive vs hidden states, as other states require listening\n * for events.\n * @return {string}\n */\nconst getCurrentState = () => {\n  if (document.readyState !== 'complete') {\n    return LOADING;\n  } else if (document.visibilityState === HIDDEN) {\n    return HIDDEN;\n  } else {\n    if (document.hasFocus()) {\n      return ACTIVE;\n    } else {\n      return PASSIVE;\n    }\n  }\n};\n\n/**\n * Class definition for the exported, singleton lifecycle instance.\n */\nexport default class Lifecycle extends EventTarget {\n  /**\n   * Initializes state, state history, and adds event listeners to monitor\n   * state changes.\n   */\n  constructor() {\n    super();\n\n    const state = getCurrentState();\n\n    this._state = state;\n    this._unsavedChanges = [];\n\n    // Bind the callback and add event listeners.\n    this._handleEvents = this._handleEvents.bind(this);\n\n    // Add capturing events on window so they run immediately.\n    EVENTS.forEach(\n        (evt) => self.addEventListener(evt, this._handleEvents, true));\n  }\n\n  /**\n   * @return {string}\n   */\n  get state() {\n    return this._state;\n  }\n\n  /**\n   * Returns the value of document.wasDiscarded. This is arguably unnecessary\n   * but I think there's value in having the entire API in one place.\n   * @return {string}\n   */\n  get pageWasDiscarded() {\n    return document.wasDiscarded;\n  }\n\n  /**\n   * @param {Symbol|Object} id A unique symbol or object identifying the\n   *.    pending state. This ID is required when removing the state later.\n   */\n  addUnsavedChanges(id) {\n    // Don't add duplicate state. Note: ideall this would be a set, but for\n    // better browser compatibility we're using an array.\n    if (!this._unsavedChanges.includes(id)) {\n      // If this is the first state being added,\n      // also add a beforeunload listener.\n      if (this._unsavedChanges.length === 0) {\n        self.addEventListener('beforeunload', onbeforeunload);\n      }\n      this._unsavedChanges.push(id);\n    }\n  }\n\n  /**\n   * @param {Symbol|Object} id A unique symbol or object identifying the\n   *.    pending state. This ID is required when removing the state later.\n   */\n  removeUnsavedChanges(id) {\n    const idIndex = this._unsavedChanges.indexOf(id);\n\n    if (idIndex > -1) {\n      this._unsavedChanges.splice(idIndex, 1);\n\n      // If there's no more pending state, remove the event listener.\n      if (this._unsavedChanges.length === 0) {\n        removeEventListener('beforeunload', onbeforeunload);\n      }\n    }\n  }\n\n  /**\n   * @private\n   * @param {string} newState\n   */\n  _dispatchChangesIfNeeded(newState) {\n    if (newState !== this._state) {\n      const oldState = this._state;\n      const path = getLegalStateTransitionPath(oldState, newState);\n\n      for (let i = 0; i < path.length - 1; ++i) {\n        const oldState = path[i];\n        const newState = path[i + 1];\n\n        this._state = newState;\n        this.dispatchEvent(\n            new StateChangeEvent('statechange', {oldState, newState}));\n      }\n    }\n  }\n\n  /**\n   * @private\n   * @param {!Event} evt\n   */\n  _handleEvents(evt) {\n    switch (evt.type) {\n      case 'pageshow':\n      case 'resume':\n        this._dispatchChangesIfNeeded(getCurrentState());\n        break;\n      case 'focus':\n        this._dispatchChangesIfNeeded(ACTIVE);\n        break;\n      case 'blur':\n        // The `blur` event can fire while the page is being unloaded, so we\n        // only need to update the state if the current state is \"active\".\n        if (this._state === ACTIVE) {\n          this._dispatchChangesIfNeeded(getCurrentState());\n        }\n        break;\n      case 'pagehide':\n        this._dispatchChangesIfNeeded(evt.persisted ? FROZEN : TERMINATED);\n        break;\n      case 'visibilitychange':\n        // The document's `visibilityState` will change to hidden  as the page\n        // is being unloaded, but in such cases the lifecycle state shouldn't\n        // change.\n        if (this._state !== FROZEN &&\n            this._state !== TERMINATED) {\n          this._dispatchChangesIfNeeded(getCurrentState());\n        }\n        break;\n      case 'freeze':\n        this._dispatchChangesIfNeeded(FROZEN);\n        break;\n    }\n  }\n}\n","/*\n Copyright 2018 Google Inc. All Rights Reserved.\n Licensed under the Apache License, Version 2.0 (the \"License\");\n you may not use this file except in compliance with the License.\n You may obtain a copy of the License at\n\n     http://www.apache.org/licenses/LICENSE-2.0\n\n Unless required by applicable law or agreed to in writing, software\n distributed under the License is distributed on an \"AS IS\" BASIS,\n WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n See the License for the specific language governing permissions and\n limitations under the License.\n*/\n\nimport Lifecycle from './Lifecycle.mjs';\n\nexport default new Lifecycle();\n","import lifecycle from '../src/export.mjs';\nimport Lifecycle from '../src/Lifecycle.mjs';\n\ndescribe('export', () => {\n  it(`is an instance of Lifecycle`, () => {\n    assert(lifecycle instanceof Lifecycle);\n  });\n});\n","/*\n Copyright 2018 Google Inc. All Rights Reserved.\n Licensed under the Apache License, Version 2.0 (the \"License\");\n you may not use this file except in compliance with the License.\n You may obtain a copy of the License at\n\n     http://www.apache.org/licenses/LICENSE-2.0\n\n Unless required by applicable law or agreed to in writing, software\n distributed under the License is distributed on an \"AS IS\" BASIS,\n WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n See the License for the specific language governing permissions and\n limitations under the License.\n*/\n\nimport Lifecycle from '../src/Lifecycle.mjs';\nimport NativeEventTargetOrEventTargetShim from '../src/shims/EventTarget.mjs';\nimport NativeEventOrEventShim from '../src/shims/Event.mjs';\n\ndescribe('Lifecycle', () => {\n  const sandbox = sinon.createSandbox();\n\n  beforeEach(() => {\n    sandbox.restore();\n  });\n\n  afterEach(() => {\n    sandbox.restore();\n  });\n\n  describe(`constructor`, () => {\n    it(`extends EventTarget`, () => {\n      const lifecycle = new Lifecycle();\n      assert(lifecycle instanceof NativeEventTargetOrEventTargetShim);\n    });\n\n    it(`adds capturing event listeners for all built-in lifecycle events`,\n        () => {\n      const spy = sandbox.spy(self, 'addEventListener');\n\n      new Lifecycle();\n\n      assert.equal(spy.callCount, 7);\n      assert(spy.calledWith('pageshow', sinon.match.func, true));\n      assert(spy.calledWith('pagehide', sinon.match.func, true));\n      assert(spy.calledWith('focus', sinon.match.func, true));\n      assert(spy.calledWith('blur', sinon.match.func, true));\n      assert(spy.calledWith('visibilitychange', sinon.match.func, true));\n      assert(spy.calledWith('freeze', sinon.match.func, true));\n      assert(spy.calledWith('resume', sinon.match.func, true));\n    });\n  });\n\n  describe(`get state`, () => {\n    it(`returns 'loading' when the document's readyState is not complete`,\n        () => {\n      sandbox.stub(document, 'readyState').value('loading');\n\n      const lifecycle1 = new Lifecycle();\n      assert.equal(lifecycle1.state, 'loading');\n\n      sandbox.stub(document, 'readyState').value('interactive');\n\n      const lifecycle2 = new Lifecycle();\n      assert.equal(lifecycle2.state, 'loading');\n\n      sandbox.stub(document, 'readyState').value('complete');\n\n      const lifecycle3 = new Lifecycle();\n      dispatchEvent(new Event('pageshow'));\n      assert.notEqual(lifecycle3.state, 'loading');\n    });\n\n    it(`returns 'active' when the document is loaded, visible, and has ` +\n        `input focus`, () => {\n      sandbox.stub(document, 'readyState').value('complete');\n      sandbox.stub(document, 'visibilityState').value('visible');\n      sandbox.stub(document, 'hasFocus').returns(true);\n\n      const lifecycle = new Lifecycle();\n      dispatchEvent(new Event('pageshow'));\n\n      assert.equal(lifecycle.state, 'active');\n    });\n\n    it(`returns 'passive' when the document is loaded, visible, and does ` +\n        `not have input focus`, () => {\n      sandbox.stub(document, 'readyState').value('complete');\n      sandbox.stub(document, 'visibilityState').value('visible');\n      sandbox.stub(document, 'hasFocus').returns(false);\n\n      const lifecycle = new Lifecycle();\n      dispatchEvent(new Event('pageshow'));\n\n      assert.equal(lifecycle.state, 'passive');\n    });\n\n    it(`returns 'hidden' when the document is loaded but hidden`, () => {\n      sandbox.stub(document, 'readyState').value('complete');\n      sandbox.stub(document, 'visibilityState').value('hidden');\n\n      const lifecycle = new Lifecycle();\n      dispatchEvent(new Event('pageshow'));\n\n      assert.equal(lifecycle.state, 'hidden');\n    });\n\n    it(`returns 'frozen' after the freeze event is fired`, () => {\n      const lifecycle = new Lifecycle();\n      dispatchEvent(new Event('freeze'));\n\n      assert.equal(lifecycle.state, 'frozen');\n    });\n\n    it(`returns 'frozen' if the page is entering the page navigation cache`,\n        () => {\n      const lifecycle = new Lifecycle();\n\n      const pagehideEvent = new Event('pagehide');\n      pagehideEvent.persisted = true;\n      dispatchEvent(pagehideEvent);\n\n      assert.equal(lifecycle.state, 'frozen');\n    });\n\n    it(`returns 'terminated' if the page is being unloaded`, () => {\n      const lifecycle = new Lifecycle();\n\n      const pagehideEvent = new Event('pagehide');\n      pagehideEvent.false = true;\n      dispatchEvent(pagehideEvent);\n\n      assert.equal(lifecycle.state, 'terminated');\n    });\n  });\n\n  describe(`get pageWasDiscarded`, () => {\n    it(`returns the value of document.wasDiscarded`, () => {\n      const lifecycle = new Lifecycle();\n      assert.equal(lifecycle.pageWasDiscarded, undefined);\n\n      document.wasDiscarded = true;\n      assert.equal(lifecycle.pageWasDiscarded, true);\n    });\n  });\n\n  describe(`addEventListener`, () => {\n    it(`adds a listener for statechange events`, () => {\n      sandbox.stub(document, 'readyState').value('loading');\n\n      const lifecycle = new Lifecycle();\n      const listener = sinon.spy();\n      lifecycle.addEventListener('statechange', listener);\n\n      // Trigger a change to the 'active' state.\n      sandbox.stub(document, 'readyState').value('complete');\n      sandbox.stub(document, 'visibilityState').value('visible');\n      sandbox.stub(document, 'hasFocus').returns(true);\n      dispatchEvent(new Event('pageshow'));\n\n      assert.equal(listener.callCount, 1);\n      assert(listener.getCall(0).calledWith(sinon.match({\n        type: 'statechange',\n        oldState: 'loading',\n        newState: 'active',\n        target: lifecycle,\n      })));\n      assert(listener.getCall(0).args[0] instanceof NativeEventOrEventShim);\n\n      // Trigger a change to the 'passive' state.\n      document.hasFocus.restore();\n      sandbox.stub(document, 'hasFocus').returns(false);\n      dispatchEvent(new Event('blur'));\n\n      assert.equal(listener.callCount, 2);\n      assert(listener.getCall(1).calledWith(sinon.match({\n        type: 'statechange',\n        oldState: 'active',\n        newState: 'passive',\n        target: lifecycle,\n      })));\n      assert(listener.getCall(0).args[0] instanceof NativeEventOrEventShim);\n    });\n\n    it(`tracks state, and statechange events for all valid transition paths`,\n        () => {\n      sandbox.stub(document, 'readyState').value('loading');\n\n      const lifecycle = new Lifecycle();\n      const listener = sinon.spy();\n      lifecycle.addEventListener('statechange', listener);\n\n      // Trigger a change to the 'active' state.\n      sandbox.stub(document, 'readyState').value('complete');\n      sandbox.stub(document, 'visibilityState').value('visible');\n      sandbox.stub(document, 'hasFocus').returns(true);\n      dispatchEvent(new Event('pageshow'));\n\n      assert.equal(listener.callCount, 1);\n      assert(listener.getCall(0).calledWith(sinon.match({\n        oldState: 'loading',\n        newState: 'active',\n      })));\n\n      // Trigger a change to the 'passive' state.\n      document.hasFocus.restore();\n      sandbox.stub(document, 'hasFocus').returns(false);\n      dispatchEvent(new Event('blur'));\n\n      assert.equal(listener.callCount, 2);\n      assert(listener.getCall(1).calledWith(sinon.match({\n        oldState: 'active',\n        newState: 'passive',\n      })));\n\n      // Trigger a change to the 'hidden' state.\n      sandbox.stub(document, 'visibilityState').value('hidden');\n      dispatchEvent(new Event('visibilitychange'));\n\n      assert.equal(listener.callCount, 3);\n      assert(listener.getCall(2).calledWith(sinon.match({\n        oldState: 'passive',\n        newState: 'hidden',\n      })));\n\n      // Trigger a change to the 'frozen' state.\n      dispatchEvent(new Event('freeze'));\n\n      assert.equal(listener.callCount, 4);\n      assert(listener.getCall(3).calledWith(sinon.match({\n        oldState: 'hidden',\n        newState: 'frozen',\n      })));\n\n      // Trigger a change back to the 'hidden' state.\n      dispatchEvent(new Event('resume'));\n\n      assert.equal(listener.callCount, 5);\n      assert(listener.getCall(4).calledWith(sinon.match({\n        oldState: 'frozen',\n        newState: 'hidden',\n      })));\n\n      // Trigger a change back to the 'passive' state.\n      sandbox.stub(document, 'visibilityState').value('visible');\n      dispatchEvent(new Event('visibilitychange'));\n\n      assert.equal(listener.callCount, 6);\n      assert(listener.getCall(5).calledWith(sinon.match({\n        oldState: 'hidden',\n        newState: 'passive',\n      })));\n\n      // Trigger a change back to the 'active' state.\n      dispatchEvent(new Event('focus'));\n\n      assert.equal(listener.callCount, 7);\n      assert(listener.getCall(6).calledWith(sinon.match({\n        oldState: 'passive',\n        newState: 'active',\n      })));\n\n      // Trigger a change back to the 'passive' state.\n      document.hasFocus.restore();\n      sandbox.stub(document, 'hasFocus').returns(false);\n      dispatchEvent(new Event('blur'));\n\n      assert.equal(listener.callCount, 8);\n      assert(listener.getCall(7).calledWith(sinon.match({\n        oldState: 'active',\n        newState: 'passive',\n      })));\n\n      // Trigger a change to the 'hidden' state.\n      sandbox.stub(document, 'visibilityState').value('hidden');\n      dispatchEvent(new Event('visibilitychange'));\n\n      assert.equal(listener.callCount, 9);\n      assert(listener.getCall(8).calledWith(sinon.match({\n        oldState: 'passive',\n        newState: 'hidden',\n      })));\n\n      // Trigger a change to the 'frozen' (bfcache) state.\n      const pagehideEvent = new Event('pagehide');\n      pagehideEvent.persisted = true;\n      dispatchEvent(pagehideEvent);\n\n      assert.equal(listener.callCount, 10);\n      assert(listener.getCall(9).calledWith(sinon.match({\n        oldState: 'hidden',\n        newState: 'frozen',\n      })));\n\n      // Trigger a change to the 'active' state (out of the bfcache).\n      sandbox.stub(document, 'readyState').value('complete');\n      sandbox.stub(document, 'visibilityState').value('visible');\n      document.hasFocus.restore();\n      sandbox.stub(document, 'hasFocus').returns(true);\n      const pageshowEvent = new Event('pageshow');\n      pageshowEvent.persisted = true;\n      dispatchEvent(pageshowEvent);\n\n      assert.equal(listener.callCount, 11);\n      assert(listener.getCall(10).calledWith(sinon.match({\n        oldState: 'frozen',\n        newState: 'active',\n      })));\n\n      // Trigger a change back to the 'passive' state.\n      document.hasFocus.restore();\n      sandbox.stub(document, 'hasFocus').returns(false);\n      dispatchEvent(new Event('blur'));\n\n      assert.equal(listener.callCount, 12);\n      assert(listener.getCall(11).calledWith(sinon.match({\n        oldState: 'active',\n        newState: 'passive',\n      })));\n\n      // Trigger a change to the 'hidden' state.\n      sandbox.stub(document, 'visibilityState').value('hidden');\n      dispatchEvent(new Event('visibilitychange'));\n\n      assert.equal(listener.callCount, 13);\n      assert(listener.getCall(12).calledWith(sinon.match({\n        oldState: 'passive',\n        newState: 'hidden',\n      })));\n\n      // Trigger a change to the 'terminated' state.\n      dispatchEvent(new Event('pagehide'));\n\n      assert.equal(listener.callCount, 14);\n      assert(listener.getCall(13).calledWith(sinon.match({\n        oldState: 'hidden',\n        newState: 'terminated',\n      })));\n    });\n\n    it(`fires intermediary events when invalid transitions are detected`,\n        () => {\n      // Make sure to instantiate in the 'active' state\n      sandbox.stub(document, 'readyState').value('complete');\n      sandbox.stub(document, 'visibilityState').value('visible');\n      sandbox.stub(document, 'hasFocus').returns(true);\n\n      const lifecycle = new Lifecycle();\n      const listener = sinon.spy();\n      lifecycle.addEventListener('statechange', listener);\n\n      // Change the page's visibilityState to hidden without first firing a\n      // blur event.\n      document.hasFocus.restore();\n      sandbox.stub(document, 'hasFocus').returns(false);\n      sandbox.stub(document, 'visibilityState').value('hidden');\n      dispatchEvent(new Event('visibilitychange'));\n\n      assert.equal(listener.callCount, 2);\n      assert(listener.getCall(0).calledWith(sinon.match({\n        oldState: 'active',\n        newState: 'passive',\n      })));\n      assert(listener.getCall(1).calledWith(sinon.match({\n        oldState: 'passive',\n        newState: 'hidden',\n      })));\n\n      // Change the page's visibilityState back to visible and set document\n      // focus without first firing a focus event.\n      listener.resetHistory();\n      document.hasFocus.restore();\n      sandbox.stub(document, 'hasFocus').returns(true);\n      sandbox.stub(document, 'visibilityState').value('visible');\n      dispatchEvent(new Event('visibilitychange'));\n\n      assert.equal(listener.callCount, 2);\n      assert(listener.getCall(0).calledWith(sinon.match({\n        oldState: 'hidden',\n        newState: 'passive',\n      })));\n      assert(listener.getCall(1).calledWith(sinon.match({\n        oldState: 'passive',\n        newState: 'active',\n      })));\n\n      // Navigate away but put the page into the bfcache.\n      listener.resetHistory();\n      document.hasFocus.restore();\n      sandbox.stub(document, 'hasFocus').returns(false);\n      const pagehideEvent = new Event('pagehide');\n      pagehideEvent.persisted = true;\n      dispatchEvent(pagehideEvent);\n\n      assert.equal(listener.callCount, 3);\n      assert(listener.getCall(0).calledWith(sinon.match({\n        oldState: 'active',\n        newState: 'passive',\n      })));\n      assert(listener.getCall(1).calledWith(sinon.match({\n        oldState: 'passive',\n        newState: 'hidden',\n      })));\n      assert(listener.getCall(2).calledWith(sinon.match({\n        oldState: 'hidden',\n        newState: 'frozen',\n      })));\n\n      // Navigate back, moving the page from frozen directly to active.\n      listener.resetHistory();\n      document.hasFocus.restore();\n      sandbox.stub(document, 'hasFocus').returns(true);\n      sandbox.stub(document, 'visibilityState').value('visible');\n      dispatchEvent(new Event('pageshow'));\n\n      assert.equal(listener.callCount, 1);\n      assert(listener.getCall(0).calledWith(sinon.match({\n        oldState: 'frozen',\n        newState: 'active',\n      })));\n\n      // Unload the active page and fire the visibilitychange event after\n      // the pagehide event. (Note: this is new behavior that's pending\n      // spec updates, so no browsers currently implement the \"right\" way.)\n      listener.resetHistory();\n      document.hasFocus.restore();\n      sandbox.stub(document, 'hasFocus').returns(false);\n      dispatchEvent(new Event('pagehide'));\n      sandbox.stub(document, 'visibilityState').value('visible');\n      dispatchEvent(new Event('visibilitychange'));\n\n      assert.equal(listener.callCount, 3);\n      assert(listener.getCall(0).calledWith(sinon.match({\n        oldState: 'active',\n        newState: 'passive',\n      })));\n      assert(listener.getCall(1).calledWith(sinon.match({\n        oldState: 'passive',\n        newState: 'hidden',\n      })));\n      assert(listener.getCall(2).calledWith(sinon.match({\n        oldState: 'hidden',\n        newState: 'terminated',\n      })));\n    });\n  });\n\n  describe(`removeEventListener`, () => {\n    it(`remove added event listeners`, () => {\n      sandbox.stub(document, 'readyState').value('loading');\n\n      const lifecycle = new Lifecycle();\n      const listener = sinon.spy();\n      lifecycle.addEventListener('statechange', listener);\n\n      // Trigger a change to the 'active' state.\n      sandbox.stub(document, 'readyState').value('complete');\n      sandbox.stub(document, 'visibilityState').value('visible');\n      sandbox.stub(document, 'hasFocus').returns(true);\n      dispatchEvent(new Event('pageshow'));\n\n      assert.equal(listener.callCount, 1);\n      assert(listener.getCall(0).calledWith(sinon.match({\n        type: 'statechange',\n        oldState: 'loading',\n        newState: 'active',\n        target: lifecycle,\n      })));\n\n      // Remove the listener, then trigger a change to the 'passive' state.\n      lifecycle.removeEventListener('statechange', listener);\n\n      document.hasFocus.restore();\n      sandbox.stub(document, 'hasFocus').returns(false);\n      dispatchEvent(new Event('blur'));\n\n      // Should not have been called again.\n      assert.equal(listener.callCount, 1);\n    });\n  });\n\n  describe(`addUnsavedChanges`, () => {\n    it(`adds a beforeunload listener to warn about unsaved changes if one ` +\n        `isn't already added`, () => {\n      const lifecycle = new Lifecycle();\n\n      const stub = sandbox.stub(self, 'addEventListener');\n      const id1 = {};\n      lifecycle.addUnsavedChanges(id1);\n\n      assert(stub.calledOnce);\n\n      const id2 = {};\n      lifecycle.addUnsavedChanges(id2);\n\n      // It shouldn't have been called again.\n      assert(stub.calledOnce);\n\n      const id3 = {};\n      lifecycle.addUnsavedChanges(id3);\n\n      // It still shouldn't have been called again.\n      assert(stub.calledOnce);\n    });\n  });\n\n  describe(`removeUnsavedChanges`, () => {\n    it(`removes a beforeunload listener to warn about unsaved changes if ` +\n        `no unsaved changes remain`, () => {\n      const lifecycle = new Lifecycle();\n\n      const addEventListenerStub = sandbox.stub(self, 'addEventListener');\n      const removeEventListenerStub = sandbox.stub(self, 'removeEventListener');\n\n      const id1 = {};\n      const id2 = {};\n      const id3 = {};\n      lifecycle.addUnsavedChanges(id1);\n      lifecycle.addUnsavedChanges(id2);\n      lifecycle.addUnsavedChanges(id3);\n\n      assert(addEventListenerStub.calledOnce);\n      assert(removeEventListenerStub.notCalled);\n\n      lifecycle.removeUnsavedChanges(id1);\n      lifecycle.removeUnsavedChanges(id2);\n\n      assert(addEventListenerStub.calledOnce);\n      assert(removeEventListenerStub.notCalled);\n\n      lifecycle.removeUnsavedChanges(id3);\n\n      assert(addEventListenerStub.calledOnce);\n      assert(removeEventListenerStub.calledOnce);\n    });\n  });\n});\n"],"names":["supportsConstructableEventTarget","EventTarget","err","EventTargetShim","_registry","type","listener","_getRegistry","push","typeRegistry","handlerIndex","indexOf","splice","evt","target","Object","freeze","forEach","EventShim","Event","StateChangeEvent","initDict","newState","oldState","LOADING","ACTIVE","PASSIVE","HIDDEN","FROZEN","TERMINATED","EVENTS","toIndexedObject","arr","reduce","acc","val","idx","onbeforeunload","preventDefault","returnValue","LEGAL_STATE_TRANSITIONS","map","getLegalStateTransitionPath","order","i","oldIndex","newIndex","keys","slice","getCurrentState","document","readyState","visibilityState","hasFocus","Lifecycle","state","_state","_unsavedChanges","_handleEvents","bind","self","addEventListener","id","includes","length","idIndex","removeEventListener","path","dispatchEvent","_dispatchChangesIfNeeded","persisted","wasDiscarded","describe","it","assert","lifecycle","sandbox","sinon","createSandbox","beforeEach","restore","afterEach","NativeEventTargetOrEventTargetShim","spy","equal","callCount","calledWith","match","func","stub","value","lifecycle1","lifecycle2","lifecycle3","notEqual","returns","pagehideEvent","false","pageWasDiscarded","undefined","getCall","args","NativeEventOrEventShim","pageshowEvent","resetHistory","id1","addUnsavedChanges","calledOnce","id2","id3","addEventListenerStub","removeEventListenerStub","notCalled","removeUnsavedChanges"],"mappings":"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"}